<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Main</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.2/angular.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css" />
    <style>


.container1 {
  float: right;
  width: 90%;
  padding: 0 0px;
  margin: 2% 0% 0% 6%;
  background: #FFFFFF;
  height: 99%;
  box-shadow: 0 16px 32px 0 rgba(0,0,0,0.50), 0 6px 20px 0 rgba(0,0,0,0.50);
  position: relative;
  z-index:1;
}

.button-group .button {
  float: left;
  width: 100%;
  background-color: #008000; /* Green */
  border: 1px solid green;
  color: white;
  text-align: center;
  text-decoration: none;
  font-size: 16px;
  cursor: pointer;
  display: block;
  padding: 15px 32px;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 3px 10px 0 rgba(0,0,0,0.50);
}

.button {
  margin: 0px 0px 10px 0px;
}

.button-group .button:not(:last-child) {
  border-bottom: none; /* Prevent double borders */
}

.button-group .button:hover {
  background-color: #228B22;
}

.container_head1 {
  float: right;
  width: 100%;
  padding: 10px;
  margin: 0px 0px 0px 20px;
  height: 100%;
  color: white;
  text-align: center;
  text-decoration: none;
  font-family: "Times New Roman", Times, serif;
}

p {
  padding: 0px 0px 0px 0px;
  margin: 10px 0px 0px 0px;
}


.hidden {
  display: none;
}

.newContainer1 {
  color: #FFFFFF;
  text-align: center;
  text-decoration: none;
  font-size: 26px;
  font-family: Arial, Helvetica, sans-serif;
  height: 15%;
  background-color: green;
  padding: 15px;
}

.windowNew {
  height: 90%;
  width: 40%;
  margin: 3px 0% 0% 30%;
  background-color: white;
  box-shadow: 0px 0px 0px 10000px rgba(0,0,0,0.50);
  position: relative;
  z-index:1;"
}

table {
    width: 100%;
    text-vertical-align: middle;
}

td {
    width: 50%;
}

    </style>
</head>




<body style="background-color: green;" ng-app="MAIN_PAGE" ng-controller="MAIN_PAGE_CONTROLLER">


<div class="row" style="height: 100px; background-color: green; padding: 40px;">
    <div class="col-md-3"></div>
    <div class="col-md-6">
        <div class="container_head1">
            <p align="center" style="color: white; font-size: 70px; margin: 0 0 0 0; padding: 0 0 0 0; text-align: center;">MiniBank</p>
        </div>
    </div>
    <div class="col-md-3"></div>
</div>



<div class="row" style="height: 600px; background-color: green; padding: 20px; margin: 10px 0 0 0;">
    <div class="container1">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>№</th>
                    <th>ФИО</th>
                    <th>Email</th>
                    <th>Дата рождения</th>
                    <th></th>
                </tr>
            </thead>
            <tbody class="ui-sortable">
                <tr ng-repeat="bankUser in bankUsers">
                    <td style="width: 5%;">{{bankUser.user_id}}</td>
                    <td style="width: 30%">{{bankUser.userName}}</td>
                    <td style="width: 30%">{{bankUser.email}}</td>
                    <td style="width: 30%">{{bankUser.birthday | date:'yyyy-MM-dd'}}</td>
                    <td style="width: 5%">
                        <div class="button-group" style="align: center; width: 100%;">
                            <a class="button" href="/getUserById/id={{bankUser.user_id}}">Выбрать</a>
                            <a class="button" href="/getUserById/id={{bankUser.user_id}}">Удалить</a>
                            <a class="button" href="/getUserById/id={{bankUser.user_id}}">Изменить</a>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="button-group" style="class: center; width: 50%;">
            <button class="button share-widget" style="margin: 0% 0 0 47%;">Добавить пользователя</button>
        </div>
    </div>


    <!--Невидимое окошко (Настроить видимость!)-->
    <div id="newWindow" class="hidden windowNew">

        <div class="newContainer1">
            <h1>Создание пользователя:</h1>
        </div>
        <div style="height: 97%; background-color: white; padding: 20px;">
<!--            user_id : $scope.bankUser.user_id,-->
<!--            userName : $scope.bankUser.userName,-->
<!--            bankCard : null,-->
<!--            balanceDollar : 0,-->
<!--            balanceEuro : 0,-->
<!--            email : $scope.bankUser.email,-->
<!--            birthday : $scope.bankUser.birthday-->
            <form>
                <div class="form-group">
                    <label for="inputUserId">ID нового пользователя:</label>
                    <input ng-model="bankUser.user_id" class="form-control" type="number" id="inputUserId">
                </div>
                <div class="form-group">
                    <label for="inputName">ФИО:</label>
                    <input ng-model="bankUser.userName" class="form-control" id="inputName">
                </div>
                <div class="form-group">
                    <label for="inputEmail">Адрес электронной почты:</label>
                    <input ng-model="bankUser.email" type="email" class="form-control" id="inputEmail" aria-describedby="emailHelp">
                </div>
                <div class="form-group">
                    <label for="datetimepicker1">Дата рождения:</label>
                    <div class="input-group" id="datetimepicker1">
                        <input type="text" class="form-control" ng-model="bankUser.birthday"/>
                        <span class="input-group-addon">
                            <i class="glyphicon glyphicon-calendar"></i>
                        </span>
                    </div>
                </div>
                <div class="button-group">
                    <button class="button share-widget">Отмена</button>
                    <button id="reload" class="button" type="submit" ng-click="saveBankUser()">Сохранить пользователя</button>
                </div>
            </form>
        </div>
    </div>
    <!--Конец невидимого окна-->

</div>

    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/moment-with-locales.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-datetimepicker.min.js"></script>

    <script type="text/javascript">

        /*
            Ангулар js. Контроллер со стороны фронтенда
        */
        var app = angular.module("MAIN_PAGE", []);
        app.controller("MAIN_PAGE_CONTROLLER", function($scope, $http) {
            console.log("Start JS");

            /*
                Массив пользователей банка
            */
            $scope.bankUsers = [];

            /*
                GET запрос на сервер с просьбой
                перечислить всех пользователей
            */
            $scope.getBankUsers = function() {
                $http({
                    url: '/home/findAllBankUser',
                    method: 'GET'
                }).then(function(response){
                    /*
                        После выполнения функции
                        записать всех пользователей
                        в массив
                    */
                    $scope.bankUsers = response.data;
                    console.log($scope.bankUsers);
                })
            }

            /*
                Сделать доступным для тела список
                всех пользователей
            */
            $scope.getBankUsers();

            /*
                GET запрос на сервер с просьбой
                сохранить нового пользователя
            */
            $scope.saveBankUser = function() {
                console.log($scope.bankUsers);
                $http({
                    url: '/home/saveBankUser',
                    method: 'POST',
                    data:
                    {
                        user_id : $scope.bankUser.user_id,
                        userName : $scope.bankUser.userName,
                        bankCard : null,
                        balanceDollar : 0,
                        balanceEuro : 0,
                        email : $scope.bankUser.email,
                        birthday : $scope.bankUser.birthday
                    }
                }).then(function(response){
                    console.log(response);
                });
            }
        });
        /* Конец части Ангулара */

        /*
            jQuery
        */

        /*
            (Для элементов принадлежащих классу
            share-widget)
            скрыть / показать окна

            # - селектор по ID
            . - селектор для класса
            * - селектор для всех элементов на странице
        */
        $('.share-widget').click(function() {
            $('#newWindow').toggleClass('hidden');
            $('.container1').toggleClass('hidden');
        });

        /*
            Перезагрузить страницу при
            клике на элемент с ID 'reload'
        */
        $('#reload').click(function() {
            location.reload();
        });

        /*
            Работа с датой (требует исправления)
        */
        var maxDate = new Date();
        maxYear = maxDate.getYear()-18;
        maxDate.setYear(maxYear);

        $(function () {
          $('#datetimepicker1').datetimepicker({
            locale: 'ru',
            stepping:10,
            format: 'YYYY-MM-DD',
            defaultDate: moment('1970.01.01').format('YYYY-MM-DD'),
            daysOfWeekDisabled:[0,6]
          });
        });

        /*
            Нерабочая функция
            Предпологала, что при клике на строку с
            данными о пользователе произойдёт
            переход на его личную страницу
        */
        // <tr data-href="site.com/whatever">
        $('tr[data-href]').on("click", function() {
            document.location = $(this).data('href');
        });
        /* Конец Query */
    </script>



</body>
</html>